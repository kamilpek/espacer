<script>
  //mapa
  var map = new google.maps.Map(document.getElementById('sidebar_builder'),{
    center:{
      <% if @place.latitude %>
      lat: <%= @place.latitude %>, lng: <%= @place.longitude %>
      <% else %>
      lat: 54.11, lng: 17.8667
      <% end %>
    },
    zoom:12
  });

  //marker
  var marker = new google.maps.Marker({
    position:{
      <% if @place.latitude %>
      lat: <%= @place.latitude %>, lng: <%= @place.longitude %>
      <% else %>
      lat: 54.11, lng: 17.8667
      <% end %>
    },
    map: map,
    draggable: true
  });

  // przenoszenie markera
  google.maps.event.addListener(marker,'dragend',function(){
    var lat = marker.getPosition().lat();
    var lng = marker.getPosition().lng();
    console.log(lat);
    console.log(lng);
    $('#place_latitude').val(lat);
    $('#place_longitude').val(lng);
  });

  // akcje podczas uruchomienia mapy
  google.maps.event.addListener(map,'idle',function(){
    var lat = marker.getPosition().lat();
    var lng = marker.getPosition().lng();
    console.log(lat);
    console.log(lng);
    $('#place_latitude').val(lat);
    $('#place_longitude').val(lng);
  });

  function geocodeLatLng(geocoder, map, infowindow) {
        var input = document.getElementById('latlng').value;
        var latlngStr = input.split(',', 2);
        var latlng = {lat: parseFloat(latlngStr[0]), lng: parseFloat(latlngStr[1])};
        geocoder.geocode({'location': latlng}, function(results, status) {
          if (status === 'OK') {
            if (results[0]) {
              map.setZoom(11);
              var marker = new google.maps.Marker({
                position: latlng,
                map: map
              });
              infowindow.setContent(results[0].formatted_address);
              infowindow.open(map, marker);
            } else {
              window.alert('No results found');
            }
          } else {
            window.alert('Geocoder failed due to: ' + status);
          }
        });
      }

</script>
